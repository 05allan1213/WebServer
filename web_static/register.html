<!DOCTYPE html>
<html>

<head>
    <title>注册</title>
    <link rel="stylesheet" href="/style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <header>
        <h1>WebServer</h1>
        <p>高性能C++服务器演示</p>
    </header>
    <div class="container">
        <nav>
            <a href="/index.html">首页</a>
            <a href="/about.html">关于我</a>
            <a href="/contact.html">联系我们</a>
            <a href="/login.html">登录</a>
        </nav>
        <div class="card" style="max-width:400px;margin:2rem auto;">
            <h2>注册账号</h2>
            <form id="registerForm" autocomplete="off">
                <div style="margin-bottom:1rem;">
                    <input type="text" name="username" placeholder="用户名" required style="width:100%;padding:0.5rem;">
                </div>
                <div style="margin-bottom:1rem;">
                    <input type="password" name="password" placeholder="密码" required minlength="6"
                        style="width:100%;padding:0.5rem;">
                </div>
                <div style="margin-bottom:1rem;">
                    <input type="password" name="confirm" placeholder="确认密码" required minlength="6"
                        style="width:100%;padding:0.5rem;">
                </div>
                <button class="btn" id="registerBtn" type="submit" style="width:100%;">注册</button>
                <div id="registerMsg" style="margin-top:1rem;color:var(--accent-color);"></div>
            </form>
            <p style="margin-top:1rem;font-size:0.95rem;">已有账号？<a href="/login.html"
                    style="color:var(--primary-color);">去登录</a></p>
        </div>
    </div>
    <footer>
        <div class="container">
            <p>© 2023 WebServer 项目演示</p>
        </div>
    </footer>
    <script>
        const form = document.getElementById('registerForm');
        const btn = document.getElementById('registerBtn');
        const msg = document.getElementById('registerMsg');
        form.onsubmit = async function (e) {
            e.preventDefault();
            msg.style.color = 'var(--accent-color)';
            msg.textContent = '';
            const username = form.username.value.trim();
            const password = form.password.value;
            const confirm = form.confirm.value;
            if (!username || !password || !confirm) {
                msg.textContent = '请填写所有字段';
                return;
            }
            if (password.length < 6) {
                msg.textContent = '密码至少6位';
                return;
            }
            if (password !== confirm) {
                msg.textContent = '两次密码不一致';
                return;
            }
            btn.disabled = true;
            btn.textContent = '注册中...';
            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                let data = {};
                try {
                    data = await res.json();
                } catch (err) {
                    data = {};
                }
                if (res.ok) {
                    msg.style.color = 'green';
                    msg.textContent = '注册成功，正在跳转...';
                    setTimeout(() => { window.location.href = '/login.html'; }, 1200);
                } else {
                    msg.textContent = data.error || data.message || '注册失败';
                }
            } catch (err) {
                msg.textContent = '网络错误，请稍后重试';
            }
            btn.disabled = false;
            btn.textContent = '注册';
        };
    </script>
</body>

</html>